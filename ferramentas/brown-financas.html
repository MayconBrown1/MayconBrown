<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle Financeiro</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: Arial, sans-serif;
    }
    h1, h2, h3, h4, h5, h6, p, span, label, input, select, button, strong, option, optgroup {
      color: white !important;
    }
    .card {
      background-color: #1e1e1e;
      border: none;
      margin-bottom: 1rem;
    }
    .form-control, .btn, select, option {
      background-color: #2c2c2c !important;
      color: white !important;
      border: none;
    }
    .form-control::placeholder {
      color: #aaa;
    }
    canvas {
      background-color: white;
      border-radius: 8px;
    }
    .saldo-display {
      font-size: 1.5rem;
      font-weight: bold;
      color: #0d6efd;
    }
    .transacao-item {
      padding: 0.5rem;
      border-bottom: 1px solid #444;
    }
    .transacao-item span {
      display: inline-block;
      min-width: 80px;
    }
    .btn-editar, .btn-apagar {
      font-size: 0.8rem;
      margin-left: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="text-center mb-4">
      <a href="http://mayconbrown.com.br/">
        <img src="https://mayconbrown.com.br/img/svg/logobranca.svg" alt="Logo" width="400">
      </a>
    </div>
    <h2 class="text-center mb-4">Controle Financeiro</h2>

    <div class="row mb-3">
      <div class="col-md-4">
        <select id="filtroMes" class="form-control" onchange="filtrarPorMes()"></select>
      </div>
    </div>

    <div class="row">
      <div class="col-md-4">
        <div class="card p-3">
          <h5>Nova Transa√ß√£o</h5>
          <input type="text" id="descricao" class="form-control mb-2" placeholder="Descri√ß√£o">
          <input type="number" id="valor" class="form-control mb-2" placeholder="Valor">
          <select id="categoria" class="form-control mb-2">
            <optgroup label="Entradas">
              <option>Sal√°rio</option>
              <option>Bicos/Freelancer</option>
              <option>Presente</option>
              <option>Investimentos</option>
              <option>Vendas</option>
              <option>Outros</option>
            </optgroup>
            <optgroup label="Sa√≠das">
              <option>Alimenta√ß√£o</option>
              <option>Transporte</option>
              <option>Sa√∫de</option>
              <option>Lazer</option>
              <option>Compras</option>
              <option>Moradia</option>
              <option>Assinaturas</option>
              <option>Outros</option>
            </optgroup>
          </select>
          <select id="tipo" class="form-control mb-3">
            <option value="entrada">Entrada</option>
            <option value="saida">Sa√≠da</option>
          </select>
          <button class="btn btn-success w-100" onclick="adicionarTransacao()">Salvar</button>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card p-3">
          <h5>Resumo</h5>
          <p>Entradas: R$ <span id="totalEntradas">0.00</span></p>
          <p>Sa√≠das: R$ <span id="totalSaidas">0.00</span></p>
          <p class="saldo-display">Saldo Atual: R$ <span id="saldo">0.00</span></p>
          <button class="btn btn-secondary" onclick="baixarBackup()">üìÅ Fazer Backup</button>
        </div>
        <div class="card p-3">
          <h5>Gr√°fico de Transa√ß√µes</h5>
          <canvas id="grafico"></canvas>
        </div>
        <div class="card p-3">
          <h5>Lista de Transa√ß√µes</h5>
          <div class="mb-2">
            <label class="me-2">
              <input type="checkbox" id="mostrarEntradas" checked onchange="renderizarLista()"> Mostrar Entradas
            </label>
            <label>
              <input type="checkbox" id="mostrarSaidas" checked onchange="renderizarLista()"> Mostrar Sa√≠das
            </label>
          </div>
          <div id="listaTransacoes"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let transacoes = JSON.parse(localStorage.getItem("transacoes")) || [];
    let mesSelecionado = new Date().toISOString().slice(0, 7);

    function obterMes(isoDate) {
      return isoDate.slice(0, 7);
    }

    function filtrarTransacoesPorMes(mes) {
      return transacoes.filter(t => obterMes(t.data) === mes);
    }

    function atualizarResumo() {
      const transacoesFiltradas = filtrarTransacoesPorMes(mesSelecionado);
      let entradas = transacoesFiltradas.filter(t => t.tipo === 'entrada').reduce((acc, t) => acc + t.valor, 0);
      let saidas = transacoesFiltradas.filter(t => t.tipo === 'saida').reduce((acc, t) => acc + t.valor, 0);
      let saldo = entradas - saidas;
      document.getElementById("totalEntradas").innerText = entradas.toFixed(2);
      document.getElementById("totalSaidas").innerText = saidas.toFixed(2);
      document.getElementById("saldo").innerText = saldo.toFixed(2);
    }

    function renderizarLista() {
      const mostrarEntradas = document.getElementById("mostrarEntradas")?.checked ?? true;
      const mostrarSaidas = document.getElementById("mostrarSaidas")?.checked ?? true;
      const lista = document.getElementById("listaTransacoes");
      lista.innerHTML = "";
      const transacoesFiltradas = filtrarTransacoesPorMes(mesSelecionado);

      transacoesFiltradas.forEach((t, i) => {
        if ((t.tipo === 'entrada' && !mostrarEntradas) || (t.tipo === 'saida' && !mostrarSaidas)) return;

        const div = document.createElement("div");
        div.className = "transacao-item";
        div.innerHTML = `
          <strong>${t.descricao}</strong> <span>R$ ${t.valor.toFixed(2)}</span>
          <span>${t.categoria}</span> <span>${t.tipo}</span>
        `;
        lista.appendChild(div);
      });
    }

    function adicionarTransacao() {
      const descricao = document.getElementById("descricao").value;
      const valor = parseFloat(document.getElementById("valor").value);
      const categoria = document.getElementById("categoria").value;
      const tipo = document.getElementById("tipo").value;
      if (!descricao || !valor || isNaN(valor)) return;
      const nova = { descricao, valor, categoria, tipo, data: new Date().toISOString() };
      transacoes.push(nova);
      salvarTransacoes();
      document.getElementById("descricao").value = "";
      document.getElementById("valor").value = "";
    }

    function salvarTransacoes() {
      localStorage.setItem("transacoes", JSON.stringify(transacoes));
      popularFiltroMes();
      atualizarResumo();
      atualizarGrafico();
      renderizarLista();
    }

    function baixarBackup() {
      const blob = new Blob([JSON.stringify(transacoes, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "backup_financeiro.json";
      a.click();
    }

    function atualizarGrafico() {
      const transacoesFiltradas = filtrarTransacoesPorMes(mesSelecionado);
      const categorias = {};
      transacoesFiltradas.forEach(t => {
        if (!categorias[t.categoria]) categorias[t.categoria] = 0;
        categorias[t.categoria] += t.tipo === 'entrada' ? t.valor : -t.valor;
      });
      const ctx = document.getElementById("grafico").getContext("2d");
      if (window.graficoFinanceiro) window.graficoFinanceiro.destroy();
      window.graficoFinanceiro = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(categorias),
          datasets: [{
            label: 'Valor por Categoria',
            data: Object.values(categorias),
            backgroundColor: '#0d6efd'
          }]
        }
      });
    }

    function popularFiltroMes() {
      const filtro = document.getElementById("filtroMes");
      const meses = [...new Set(transacoes.map(t => obterMes(t.data)))].sort().reverse();
      filtro.innerHTML = meses.map(m => `<option value="${m}">${m}</option>`).join("");
      filtro.value = mesSelecionado;
    }

    function filtrarPorMes() {
      mesSelecionado = document.getElementById("filtroMes").value;
      salvarTransacoes();
    }

    salvarTransacoes();
  </script>
</body>
</html>
