<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caixa Conveniência</title>
  <script src="https://unpkg.com/@zxing/browser@latest"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #000;
      color: #fff;
    }
    h1, h2, h3 {
      text-align: center;
      color: #fff;
    }
    #scanner, #cadastro, #vendas {
      margin-top: 2rem;
    }
    input, button, select {
      padding: 8px;
      margin: 4px;
      border: none;
      border-radius: 4px;
    }
    button {
      background: #333;
      color: #fff;
      cursor: pointer;
    }
    img {
      max-width: 100px;
    }
    .produto {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      background: #222;
      padding: 10px;
      border-radius: 5px;
    }
    .logo {
      display: block;
      margin: 0 auto;
      max-width: 400px;
    }
  </style>
</head>
<body>
  <img src="https://mayconbrown.com.br/img/svg/logobranca.svg" class="logo" alt="Logo" />
  <h1>Sistema de Caixa para Conveniência</h1>

  <section id="cadastro">
    <h2>Cadastro de Produtos</h2>
    <input id="codigo" placeholder="Código de Barras" />
    <input id="nome" placeholder="Nome do Produto" />
    <input id="preco" type="number" placeholder="Preço (R$)" />
    <input id="imagem" type="text" placeholder="URL da Imagem" />
    <button onclick="cadastrarProduto()">Cadastrar</button>
    <button onclick="fazerBackup()">Fazer Backup</button>
    <button onclick="restaurarBackup()">Restaurar Backup</button>
  </section>

  <section id="scanner">
    <h2>Leitor de Códigos</h2>
    <video id="video" width="300" height="200"></video>
  </section>

  <section id="vendas">
    <h2>Venda Atual</h2>
    <div id="listaProdutos"></div>
    <h3>Total: R$ <span id="total">0.00</span></h3>
    <select id="pagamento">
      <option value="Dinheiro">Dinheiro</option>
      <option value="Cartão">Cartão</option>
      <option value="Pix">Pix</option>
    </select>
    <button onclick="finalizarVenda()">Finalizar</button>
  </section>

  <script>
    let produtos = JSON.parse(localStorage.getItem('produtos') || '{}');
    let vendaAtual = [];

    function cadastrarProduto() {
      const codigo = document.getElementById('codigo').value;
      const nome = document.getElementById('nome').value;
      const preco = parseFloat(document.getElementById('preco').value);
      const imagem = document.getElementById('imagem').value;

      if (!codigo || !nome || isNaN(preco)) return alert('Preencha os campos corretamente');
      produtos[codigo] = { nome, preco, imagem };
      localStorage.setItem('produtos', JSON.stringify(produtos));
      alert('Produto cadastrado!');
    }

    function fazerBackup() {
      const blob = new Blob([JSON.stringify(produtos, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'backup_produtos.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function restaurarBackup() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = (event) => {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          try {
            produtos = JSON.parse(reader.result);
            localStorage.setItem('produtos', JSON.stringify(produtos));
            alert('Backup restaurado com sucesso!');
          } catch (e) {
            alert('Erro ao restaurar o backup.');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function adicionarProduto(codigo) {
      if (!produtos[codigo]) return alert('Produto não encontrado');
      vendaAtual.push(produtos[codigo]);
      atualizarLista();
    }

    function atualizarLista() {
      const lista = document.getElementById('listaProdutos');
      lista.innerHTML = '';
      let total = 0;
      vendaAtual.forEach(prod => {
        total += prod.preco;
        lista.innerHTML += `
          <div class="produto">
            <img src="${prod.imagem}" alt="img" />
            <span>${prod.nome} - R$ ${prod.preco.toFixed(2)}</span>
          </div>
        `;
      });
      document.getElementById('total').innerText = total.toFixed(2);
    }

    function finalizarVenda() {
      if (vendaAtual.length === 0) return alert('Nenhum produto na venda.');
      const forma = document.getElementById('pagamento').value;
      const total = document.getElementById('total').innerText;
      alert(`Venda finalizada!\nTotal: R$ ${total}\nPagamento: ${forma}`);
      vendaAtual = [];
      atualizarLista();
    }

    async function iniciarScanner() {
      const codeReader = new ZXing.BrowserBarcodeReader();
      const videoInputDevices = await codeReader.listVideoInputDevices();
      if (videoInputDevices.length === 0) return alert('Nenhuma câmera encontrada');

      const selectedDeviceId = videoInputDevices[0].deviceId;

      codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
        if (result) {
          adicionarProduto(result.text);
        }
      });
    }

    iniciarScanner();
  </script>
</body>
</html>
